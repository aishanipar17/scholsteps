<script>
  document.getElementById("roiForm").addEventListener("submit", function (e) {
    e.preventDefault();

    // Get and validate inputs
    const tuition = parseFloat(document.getElementById("tuition").value);
    const living = parseFloat(document.getElementById("living").value);
    const scholarship = parseFloat(document.getElementById("scholarship").value);
    const salaryStart = parseFloat(document.getElementById("salary").value);
    const growthRate = parseFloat(document.getElementById("growth").value) / 100;

    if (
      isNaN(tuition) || isNaN(living) || isNaN(scholarship) ||
      isNaN(salaryStart) || isNaN(growthRate)
    ) {
      alert("Please fill in all fields with valid numbers.");
      return;
    }

    const annualCost = tuition + living;
    const years = 4;
    const yearlyScholarship = scholarship / years;
    let netTotal = 0;

    const table = document.getElementById("costTable");
    table.innerHTML = "";

    for (let year = 1; year <= years; year++) {
      const net = annualCost - yearlyScholarship;
      netTotal += net;

      table.innerHTML += `
        <tr>
          <td class="p-2 border">${year}</td>
          <td class="p-2 border">$${annualCost.toLocaleString()}</td>
          <td class="p-2 border">$${yearlyScholarship.toLocaleString()}</td>
          <td class="p-2 border font-semibold text-red-600">$${net.toLocaleString()}</td>
        </tr>
      `;
    }

    // Calculate 10-year total earnings
    let totalEarnings = 0;
    let salaries = [];

    for (let i = 0; i < 10; i++) {
      const salary = salaryStart * Math.pow(1 + growthRate, i);
      totalEarnings += salary;
      salaries.push(Math.round(salary));
    }

    const roi = ((totalEarnings - netTotal) / netTotal) * 100;

    // Estimate breakeven year (first year cumulative salary exceeds net cost)
    let breakevenYear = "10+ (Not yet)";
    let cumulative = 0;
    for (let i = 0; i < salaries.length; i++) {
      cumulative += salaries[i];
      if (cumulative >= netTotal) {
        breakevenYear = i + 1;
        break;
      }
    }

    // Output text
    document.getElementById("totalNet").textContent =
      `ðŸ’° Total Net Cost (After Scholarship): $${netTotal.toLocaleString()}`;
    document.getElementById("roi").textContent =
      `ðŸ“ˆ Estimated ROI Over 10 Years: ${roi.toFixed(2)}%`;
    document.getElementById("breakeven").textContent =
      `â³ Break-even Estimate: ~${breakevenYear} year${breakevenYear > 1 ? "s" : ""} after graduation`;

    document.getElementById("results").classList.remove("hidden");

    // Chart.js graph
    const ctx = document.getElementById("chart").getContext("2d");
    if (window.salaryChart) window.salaryChart.destroy();
    window.salaryChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: Array.from({ length: 10 }, (_, i) => `Year ${i + 1}`),
        datasets: [
          {
            label: "Projected Salary ($)",
            data: salaries,
            borderColor: "blue",
            backgroundColor: "rgba(0,0,255,0.1)",
            tension: 0.3,
            fill: true,
          },
          {
            label: "Total Net Cost (Target)",
            data: Array(10).fill(netTotal),
            borderDash: [6, 6],
            borderColor: "red",
            borderWidth: 2,
            fill: false,
          },
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top',
          },
          tooltip: {
            callbacks: {
              label: function (context) {
                return `${context.dataset.label}: $${context.parsed.y.toLocaleString()}`;
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: (val) => "$" + val.toLocaleString()
            }
          }
        }
      }
    });
  });
</script>

